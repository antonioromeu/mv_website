---
import { festivalsContent } from '../../content/festivals';

interface Props {
    lang: 'en' | 'pt';
}

const { lang = 'en' } = Astro.props;
const t = festivalsContent[lang];

// Split data for mobile pages (e.g., first 15 on page 1, rest on page 2)
const page1 = t.items.slice(0, 15);
const page2 = t.items.slice(15);
---

<section 
    id="festivals-awards" 
    data-color="var(--color-blue)" 
    class="
        snap-section shrink-0
        md:flex-row md:items-center"
    style="padding-top: var(--nav-height);"
>
    <!-- Mobile view  -->
    <div class="flex flex-col w-full h-full overflow-hidden md:hidden">
        <!-- Header -->
        <div class="w-full px-[3.5vw] pt-[6vh] pb-[1vh]">
            <div class="border-b border-current pb-[1vh]">
                <span class="block text-xs font-bold">{t.title}</span>
            </div>
        </div>
        
        <!-- Scrollable pages container -->
        <div class="flex-1 overflow-x-auto snap-x snap-mandatory hide-scrollbar flex" id="festivals-scroll">
            <!-- Page 1 -->
            <div class="w-full h-full snap-start flex px-[3.5vw] py-[0.5vh] shrink-0">
                <div class="text-[10px] leading-relaxed space-y-[1vh]">
                    {page1.map(item => (
                        <div>
                            {item.year} <strong>{item.event}</strong> {item.loc}
                            {item.detail && <br />}{item.detail}
                            {item.award && <br />}<strong>{item.award}</strong>
                            {item.award2 && <br />}<strong>{item.award2}</strong>
                        </div>
                    ))}
                </div>
            </div>

            <!-- Page 2 -->
            <div class="w-full h-full snap-start flex px-[3.5vw] py-[0.5vh] shrink-0">
                <div class="text-[10px] leading-relaxed space-y-[1vh]">
                    {page2.map(item => (
                        <div>
                            {item.year} <strong>{item.event}</strong> {item.loc}
                            {item.detail && <br />}{item.detail}
                            {item.award && <br />}<strong>{item.award}</strong>
                        </div>
                    ))}
                </div>
            </div>
        </div>

        <!-- Page indicators -->
        <div class="flex justify-center gap-2 py-[2vh]">
            <div class="page-indicator w-1.5 h-1.5 rounded-full bg-current transition-opacity" data-page="0"></div>
            <div class="page-indicator w-1.5 h-1.5 rounded-full bg-current opacity-30 transition-opacity" data-page="1"></div>
        </div>
    </div>

    <!-- Desktop view -->
    <div class="hidden flex-col w-full h-full pt-[3vh] px-[3.5vw] md:flex">
        <div class="w-full border-b border-current pb-[1vh] mb-[1vh]">
            <div class="flex flex-col">
                <span class="block font-bold text-lg">{t.title}</span>
            </div>
        </div>
        <div class="columns-3 gap-10 text-[10px] leading-relaxed">
            {t.items.map(item => (
                <div class="break-inside-avoid mb-6">
                    {item.year} <strong>{item.event}</strong> {item.loc}
                    {item.detail && <br />}{item.detail}
                    {item.award && <br />}<strong>{item.award}</strong>
                    {item.award2 && <br />}<strong>{item.award2}</strong>
                </div>
            ))}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Page indicator logic for mobile
        const scrollContainer = document.getElementById('festivals-scroll');
        const indicators = document.querySelectorAll('.page-indicator');

        if (scrollContainer && indicators.length > 0) {
            scrollContainer.addEventListener('scroll', () => {
                const scrollLeft = scrollContainer.scrollLeft;
                const pageWidth = scrollContainer.clientWidth;
                const currentPage = Math.round(scrollLeft / pageWidth);

                indicators.forEach((indicator, index) => {
                    if (index === currentPage) {
                        (indicator as HTMLElement).style.opacity = '1';
                    } else {
                        (indicator as HTMLElement).style.opacity = '0.3';
                    }
                });
            });
        }
    });
</script>