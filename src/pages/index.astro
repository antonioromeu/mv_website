---
import BaseLayout from '../layouts/base_layout.astro';
import LandingPage from '../components/sections/landing_page.astro';
import ChuvasDeVerao from '../components/sections/cdv.astro';
import ForaDaBouca from '../components/sections/fdb.astro';
import VideoModal from '../components/video_modal.astro';
// import EisOHomem from '../components/sections/cdv.astro';
// import About from '../components/sections/about.astro';
---
<BaseLayout title="MÃ¡rio Veloso | Filmmaker">
    <LandingPage />

    <ChuvasDeVerao />

    <ForaDaBouca />

    <VideoModal />

    <script>
        window.addEventListener('load', () => {
            const sections = document.querySelectorAll('.color-section');
            const navLinks = document.querySelectorAll('.nav-link');
            const body = document.body;

            const updateStyles = () => {
                // 1. Define the type clearly
                let currentSection: HTMLElement | null = null;
                
                // The "trigger point" is 40% down the screen
                const triggerPoint = window.innerHeight * 0.4;

                sections.forEach((section) => {
                    // 2. Cast the section to HTMLElement
                    const el = section as HTMLElement;
                    const rect = el.getBoundingClientRect();
                    if (rect.top <= triggerPoint && rect.bottom >= triggerPoint) {
                        currentSection = el;
                    }
                });

                // 3. This check now satisfies TypeScript
                if (currentSection) {
                    const newColor = (currentSection as HTMLElement).getAttribute('data-color') ?? '#0000fe';
                    const sectionId = (currentSection as HTMLElement).getAttribute('id');

                    // Update Body Color
                    body.style.color = newColor;

                    // Update Nav Links
                    navLinks.forEach(link => {
                        const href = link.getAttribute('href');
                        if (href && (href === `#${sectionId}` || href.endsWith(`/#${sectionId}`))) {
                            link.classList.add('nav-link-active');
                        } else {
                            link.classList.remove('nav-link-active');
                        }
                    });
                }
            };

            // Run on scroll and on initial load
            window.addEventListener('scroll', updateStyles);
            updateStyles(); 
        });
    </script>
</BaseLayout>